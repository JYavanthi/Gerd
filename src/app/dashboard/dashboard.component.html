<div class="dashboard-container">
 
  
  <app-sidebar></app-sidebar>
  <!-- Main Content -->
  <main class="main-content">
    <h1 class="title">WELCOME TO GERD REGISTRY</h1>

    <!-- Stat Cards -->
    <div class="stat-cards">
      <div class="card add-case" (click)="navigateToAddCase()">ADD NEW CASE</div>
      <div class="card view-submitted">
        <div>View Submitted<br />cases</div>
        <div class="value">{{ totalCases }}</div>
      </div>
      <div class="card incomplete">
        <div>Pending<br />Cases</div>
        <div class="value">{{ pendingCases }}</div>
      </div>
      <div class="card complete">
        <div>Completed<br />Cases</div>
        <div class="value">{{ completedCases }}</div>
      </div>
      <div class="card gender">
        Patient Gender<br />
        <strong>Male:</strong> {{ maleCount }} <strong>Female:</strong> {{ femaleCount }}
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts">
      <!-- Pie Chart -->
      <div class="chart-box">
        <h2 class="chart-title">Purchase Cases</h2>
        <div class="chart-fixed">
          <canvas baseChart [data]="pieChartData" [options]="pieChartOptions" [type]="'pie'">
          </canvas>
        </div>
        
      </div>

      <!-- Bar Chart -->
      <div class="chart-box">
        <h2 class="chart-title">Cases By Month</h2>
        <div class="chart-bar">
          <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="'bar'">
          </canvas>
        </div>
        

      </div>
    </div>
    <!-- Case Table Section -->
    <!-- Case Table Section -->
    <!-- Case Table Section -->
    <div class="case-table">
      <!-- Add New Case Button -->
      <div class="case-table-header">
        <button class="add-case-btn" (click)="navigateToAddCase()">Add New Case</button>
      </div>

      <div class="table-scroll" style="max-height: 400px; overflow-y: auto;">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Patient Initials</th>
              <th>Subject No</th>
              <th>Gender</th>
              <th>DOB</th>
              <th>Baseline</th>
              <th>Follow Up 1</th>
              <th>Follow Up 2</th>
              <th>Status</th>
              <th>Action</th>
              <!-- <th>View</th> -->
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of tableData">
              <td>{{ row.patientId }}</td>
              <td>{{ row.initial }}</td>
              <td>{{ row.subjectNo }}</td>
              <td>{{ row.gender }}</td>
              <td>{{ row.date | date : "dd-MM-yyyy"}}</td>
              <td [ngClass]="row.baselineClass" (click)="handleStageClick(row, 'baseline')">
                {{ row.baseline }}
              </td>
              <td [ngClass]="row.followUp1Class" (click)="handleStageClick(row, 'followUp1')">
                {{ row.followUp1 }}
              </td>
              <td [ngClass]="row.followUp2Class" (click)="handleStageClick(row, 'followUp2')">
                {{ row.followUp2 }}
              </td>

              <td [ngClass]="row?.status?.toLowerCase()">{{ row.status }}</td>
              <!-- <td class="download">
                <button class="view-btn" (click)="download(row, 'baseline')" title="Download Baseline">
                  <i class="fa-solid fa-download"></i> 
                </button>
              </td> -->

              <td class="download">
  <button class="view-btn" (click)="downloadAllStages(row.patientId)" title="Download All Stages">
    <i class="fa-solid fa-download"></i>
  </button>
</td>
             
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination-wrapper">
        <div class="pagination-info">
          Showing {{ ((currentPage - 1) * itemsPerPage) + 1 }} to
          {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} entries
        </div>
        <div class="pagination-controls">
          <button class="pagination-btn" (click)="goToPrevious()" [disabled]="currentPage === 1">
            Previous
          </button>
          <button *ngFor="let page of pageNumbers" class="pagination-btn page-number"
            [class.active]="page === currentPage" (click)="goToPage(page)">
            {{ page }}
          </button>
          <button class="pagination-btn" (click)="goToNext()" [disabled]="currentPage === totalPages">
            Next
          </button>
        </div>
      </div>
    </div>

  </main>
</div>